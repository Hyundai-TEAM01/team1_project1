<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.webapp.dao.CartDAO">
	<select id="getCartDetailList" resultType="cartDetail" parameterType="int">
		SELECT cartdetailno, cartno, pcode, psize, pcolor, amount, regdate, isdeleted FROM CARTDETAIL WHERE CARTNO = #{cartNo}
	</select>
	
	<select id="getCartProductList" resultType="cartProductInfo" parameterType="int">
		SELECT cartdetailno, cartno, cd.pcode, psize, cd.pcolor, amount, regdate, isdeleted, imgurl1 as imgurl , pbrand, pname, pprice 
		FROM CARTDETAIL cd, PRODUCTIMG img, PRODUCT p
		WHERE CARTNO = #{cartNo} and cd.PCODE = img.pcode and img.pcolor = cd.pcolor and p.pcode = cd.pcode and isdeleted = 0
	</select>
	
	<update id="removeCartDetail" parameterType="int">
		UPDATE cartdetail SET isdeleted = 1 WHERE cartdetailno = #{cartdetailno}
	</update>
	
	<update id="removeCartDetailList">
		UPDATE cartdetail SET isdeleted = 1 
		WHERE cartdetailno IN 
			<foreach collection="array" item="item" separator="," open="(" close=")">
				${item}
			</foreach>
	</update>
	
	<insert id="insertCartDetail" parameterType="cartDetail">
		INSERT INTO cartdetail values (SEQ_CARTDETAILNO.NEXTVAL,#{cartNo}, #{pcode},#{psize},#{pcolor},#{amount},SYSDATE,0)
	</insert>
	
	<select id="selectByCartDetailNo" parameterType="int" resultType="cartDetail">
		SELECT cartdetailno, cartno, pcode, psize, pcolor, amount, regdate, isdeleted FROM CARTDETAIL WHERE cartdetailno = #{cartdetailno}
	</select>
	
	
	<select id="getCartProductListByArray" parameterType="int" resultType="cartProductInfo">
		SELECT cartdetailno, cartno, cd.pcode, psize, cd.pcolor, amount, regdate, isdeleted, imgurl1 as imgurl , pbrand, pname, pprice 
		FROM CARTDETAIL cd, PRODUCTIMG img, PRODUCT p
		WHERE cd.PCODE = img.pcode and img.pcolor = cd.pcolor and p.pcode = cd.pcode and isdeleted = 0 AND cartdetailno IN 
			<foreach collection="param1" item="item" separator="," open="(" close=")">
				#{item}
			</foreach>
			<if test="param2 > 0" >
				AND cartno = #{param2}
			</if>
	</select>
</mapper>